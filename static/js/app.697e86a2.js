(function(){"use strict";var e={127:function(e,t,s){var o=s(3751),n=s(641);const r={class:"min-h-screen bg-gray-50 flex items-center justify-center"};function a(e,t,s,a,i,c){const l=(0,n.g2)("Login"),u=(0,n.g2)("Register"),d=(0,n.g2)("ChatInterface");return(0,n.uX)(),(0,n.CE)("div",r,[(0,n.bF)(o.eB,{name:"fade",mode:"out-in"},{default:(0,n.k6)((()=>["login"===i.currentView?((0,n.uX)(),(0,n.Wv)(l,{key:0,onLoginSuccess:c.onLoginSuccess,onShowRegister:c.showRegister},null,8,["onLoginSuccess","onShowRegister"])):"register"===i.currentView?((0,n.uX)(),(0,n.Wv)(u,{key:1,onShowLogin:c.showLogin},null,8,["onShowLogin"])):((0,n.uX)(),(0,n.Wv)(d,{key:2,onLogout:c.logout},null,8,["onLogout"]))])),_:1})])}const i=e=>((0,n.Qi)("data-v-d55627d8"),e=e(),(0,n.jt)(),e),c={class:"bg-white p-8 rounded-lg shadow-md w-full max-w-md"},l=i((()=>(0,n.Lk)("h1",{class:"text-2xl font-semibold text-center mb-6"},"Welcome back",-1))),u={class:"text-center mt-4"};function d(e,t,s,r,a,i){return(0,n.uX)(),(0,n.Wv)(o.eB,{name:"fade"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",c,[l,(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e),placeholder:"Email address",required:"",class:"w-full px-4 py-2 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"},null,512),[[o.Jo,a.username]]),(0,n.bo)((0,n.Lk)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e),placeholder:"Password",required:"",class:"w-full px-4 py-2 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"},null,512),[[o.Jo,a.password]]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>i.login&&i.login(...e)),class:"w-full bg-gray-800 text-white py-2 rounded-md hover:bg-gray-700 transition duration-300"}," Log in "),(0,n.Lk)("div",u,[(0,n.Lk)("a",{href:"#",onClick:t[3]||(t[3]=(0,o.D$)((t=>e.$emit("show-register")),["prevent"])),class:"text-gray-600 hover:underline"}," Don't hav e an account? Sign up ")])])])),_:1})}var h={name:"LoginForm",data(){return{username:"",password:""}},methods:{login(){fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}).then((e=>e.json())).then((e=>{"登录成功"===e.message?this.$emit("login-success"):alert(e.message)})).catch((e=>{console.error("Error:",e)}))}}},g=s(6262);const p=(0,g.A)(h,[["render",d],["__scopeId","data-v-d55627d8"]]);var f=p;const m=e=>((0,n.Qi)("data-v-0681ccb2"),e=e(),(0,n.jt)(),e),v={class:"bg-white p-8 rounded-lg shadow-md w-full max-w-md"},y=m((()=>(0,n.Lk)("h1",{class:"text-2xl font-semibold text-center mb-6"},"Create your account",-1))),w={class:"text-center mt-4"};function b(e,t,s,r,a,i){return(0,n.uX)(),(0,n.Wv)(o.eB,{name:"fade"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",v,[y,(0,n.bo)((0,n.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>a.username=e),placeholder:"Email address",required:"",class:"w-full px-4 py-2 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"},null,512),[[o.Jo,a.username]]),(0,n.bo)((0,n.Lk)("input",{type:"password","onUpdate:modelValue":t[1]||(t[1]=e=>a.password=e),placeholder:"Password",required:"",class:"w-full px-4 py-2 mb-4 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-gray-400"},null,512),[[o.Jo,a.password]]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>i.register&&i.register(...e)),class:"w-full bg-gray-800 text-white py-2 rounded-md hover:bg-gray-700 transition duration-300"}," Sign up "),(0,n.Lk)("div",w,[(0,n.Lk)("a",{href:"#",onClick:t[3]||(t[3]=(0,o.D$)((t=>e.$emit("show-login")),["prevent"])),class:"text-gray-600 hover:underline"}," Already have an account? Log in ")])])])),_:1})}var x={name:"RegisterForm",data(){return{username:"",password:""}},methods:{register(){fetch("/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}).then((e=>e.json())).then((e=>{alert(e.message),"注册成功"===e.message&&this.$emit("show-login")})).catch((e=>{console.error("Error:",e)}))}}};const k=(0,g.A)(x,[["render",b],["__scopeId","data-v-0681ccb2"]]);var C=k,L=s(33);const _=e=>((0,n.Qi)("data-v-56bc4a7e"),e=e(),(0,n.jt)(),e),I={class:"flex h-screen w-screen bg-gray-50"},S={class:"w-1/5 bg-white border-r border-gray-200 flex flex-col"},A={class:"p-4"},E=_((()=>(0,n.Lk)("i",{class:"fas fa-plus mr-2"},null,-1))),j={class:"flex-1 overflow-y-auto"},T=["onClick"],O=_((()=>(0,n.Lk)("i",{class:"far fa-comment-alt mr-3"},null,-1))),M={class:"text-sm"},F=["onClick"],$=_((()=>(0,n.Lk)("i",{class:"fas fa-trash-alt"},null,-1))),V=[$],X={class:"p-4 border-t border-gray-200"},P=_((()=>(0,n.Lk)("i",{class:"fas fa-sign-out-alt mr-2"},null,-1))),B={class:"flex-1 flex flex-col"},R={class:"flex-1 overflow-y-auto px-4 py-6",ref:"chatMessages"},J={class:"border-t border-gray-200 p-4"},U={class:"flex items-center bg-white rounded-lg shadow-sm"},W=_((()=>(0,n.Lk)("i",{class:"fas fa-paper-plane"},null,-1))),q=[W],H=_((()=>(0,n.Lk)("i",{class:"fas fa-paperclip"},null,-1))),D=[H],N=_((()=>(0,n.Lk)("div",{class:"text-xs text-gray-500 mt-2 text-center"}," ChatGPT may produce inaccurate information about people, places, or facts. ",-1)));function K(e,t,s,r,a,i){const c=(0,n.g2)("ChatMessageComponent");return(0,n.uX)(),(0,n.CE)("div",I,[(0,n.bo)((0,n.Lk)("div",S,[(0,n.Lk)("div",A,[(0,n.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>i.newConversation&&i.newConversation(...e)),class:"w-full bg-gray-100 text-gray-800 py-2 px-4 rounded-md hover:bg-gray-200 transition duration-300 flex items-center justify-center"},[E,(0,n.eW)(" New Chat ")])]),(0,n.Lk)("div",j,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.conversations,((e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:(0,L.C4)(["p-3 hover:bg-gray-100 cursor-pointer transition duration-300 flex items-center justify-between",{"bg-gray-100":a.currentConversationIndex===t}])},[(0,n.Lk)("div",{onClick:e=>i.switchConversation(t),class:"flex items-center flex-grow"},[O,(0,n.Lk)("span",M,(0,L.v_)(e.title||`Chat ${t+1}`),1)],8,T),(0,n.Lk)("button",{onClick:e=>i.deleteConversation(t),class:"text-red-500 hover:text-red-700"},V,8,F)],2)))),128))]),(0,n.Lk)("div",X,[(0,n.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>i.logout&&i.logout(...e)),class:"w-full text-left py-2 px-4 rounded-md hover:bg-gray-100 transition duration-300 flex items-center"},[P,(0,n.eW)(" Log out ")])])],512),[[o.aG,a.showSidebar]]),(0,n.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>i.toggleSidebar&&i.toggleSidebar(...e)),class:"fixed top-4 left-4 z-10 bg-white p-2 rounded-full shadow-md"},[(0,n.Lk)("i",{class:(0,L.C4)(a.showSidebar?"fas fa-times":"fas fa-bars")},null,2)]),(0,n.Lk)("div",B,[(0,n.Lk)("div",R,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.messages,((e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:"mb-6"},[(0,n.bF)(c,{message:e},null,8,["message"])])))),128))],512),(0,n.Lk)("div",J,[(0,n.Lk)("div",U,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>a.userInput=e),onKeyup:t[4]||(t[4]=(0,o.jR)(((...e)=>i.sendMessage&&i.sendMessage(...e)),["enter"])),placeholder:"Send a message...",class:"flex-1 px-4 py-2 focus:outline-none resize-none",rows:"1"},null,544),[[o.Jo,a.userInput]]),(0,n.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>i.sendMessage&&i.sendMessage(...e)),class:"p-2 text-gray-500 hover:text-gray-700"},q),(0,n.Lk)("input",{type:"file",ref:"fileInput",onChange:t[6]||(t[6]=(...e)=>i.handleFileUpload&&i.handleFileUpload(...e)),multiple:"",style:{display:"none"}},null,544),(0,n.Lk)("button",{onClick:t[7]||(t[7]=t=>e.$refs.fileInput.click()),class:"p-2 text-gray-500 hover:text-gray-700"},D)]),N])])])}var Q=s(2053);const z={class:"mb-6"},G=["innerHTML"];function Y(e,t,s,r,a,i){return(0,n.uX)(),(0,n.CE)("div",z,[(0,n.bF)(o.eB,{name:"fade"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",{class:(0,L.C4)(["flex",{"justify-end":"user"===s.message.sender}])},[(0,n.Lk)("div",{class:(0,L.C4)(["max-w-2xl rounded-lg p-3 shadow","user"===s.message.sender?"bg-blue-500 text-white":"bg-white text-black"])},[(0,n.Lk)("div",{class:"message-content",innerHTML:i.formattedMessage},null,8,G)],2)],2)])),_:1})])}s(2838);var Z=s(7453),ee=s(508),te={name:"ChatMessageComponent",props:{message:{type:Object,required:!0}},computed:{formattedMessage(){return"ai"===this.message.sender?(Z.xI.setOptions({highlight:function(e,t){return t&&ee.A.getLanguage(t)?ee.A.highlight(t,e).value:ee.A.highlightAuto(e).value},langPrefix:"hljs language-"}),(0,Z.xI)(this.message.content)):this.message.content}},mounted(){this.$nextTick((()=>{this.$el.querySelectorAll("pre code").forEach((e=>{ee.A.highlightElement(e)}))}))}};const se=(0,g.A)(te,[["render",Y],["__scopeId","data-v-38f809e7"]]);var oe=se,ne={name:"ChatInterface",data(){return{messages:[],userInput:"",conversations:[],currentConversationIndex:0,showSidebar:!0,isLoading:!1}},components:{ChatMessageComponent:oe},mounted(){this.loadConversations(),this.switchConversation(0),this.scrollToBottom()},methods:{async sendMessage(){if(""===this.userInput.trim())return;const e={sender:"user",content:this.userInput};this.messages.push(e),this.userInput="",this.scrollToBottom(),this.isLoading=!0;try{const t=await fetch("/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:e.content})}),s=t.body.getReader(),o=new TextDecoder("utf-8");let n="";while(1){const{done:e,value:t}=await s.read();if(e)break;const r=o.decode(t);n+=r,this.updateLastAIMessage(n)}}catch(t){console.error("Error:",t)}finally{this.isLoading=!1,this.conversations[this.currentConversationIndex]=[...this.messages],this.scrollToBottom()}},updateLastAIMessage(e){const t=this.messages[this.messages.length-1];"ai"===t.sender?t.content=e:this.messages.push({sender:"ai",content:e})},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.chatMessages;e.scrollTop=e.scrollHeight}))},logout(){Q.A.get("/logout").then((()=>{this.$emit("logout")})).catch((e=>{console.error("Logout error:",e)}))},async loadChatHistory(){try{const e=await Q.A.get("/get_chat_history");this.messages=e.data.chat_history,this.conversations[0]=[...this.messages]}catch(e){console.error("Error loading chat history:",e)}},async clearHistory(){try{await Q.A.post("/clear_chat_history"),this.messages=[],this.conversations[this.currentConversationIndex]=[]}catch(e){console.error("Error clearing chat history:",e)}},async loadConversations(){try{const e=await Q.A.get("/get_conversations");this.conversations=e.data.conversations,console.log("Conversations:",this.conversations),console.log("Conversations:",this.conversations)}catch(e){console.error("Error loading conversations:",e)}},async newConversation(){try{const e=await Q.A.post("/new_conversation");this.conversations.push(e.data.history_num),console.log("num conunt",e.data.history_num),this.switchConversation(e.data.history_num-1)}catch(e){console.error("Error creating new conversation:",e)}},async switchConversation(e){this.currentConversationIndex=e;try{const t=await Q.A.post("/switch_conversation",{history_num:e});t.data.chat_history?this.messages=t.data.chat_history.map((e=>({sender:"HumanMessage"===e.type?"user":"ai",content:e.content}))):this.messages=[],this.scrollToBottom()}catch(t){console.error("Error switching conversation:",t)}},async getConversations(){try{const e=await Q.A.get("/get_conversations");this.conversations=e.data.conversations}catch(e){console.error("Error fetching conversations:",e)}},async handleFileUpload(){const e=this.$refs.fileInput.files;if(0===e.length)return;const t=new FormData;for(let o=0;o<e.length;o++)t.append("files",e[o]);try{const e=await Q.A.post("/upload",t,{headers:{"Content-Type":"multipart/form-data"}});console.log(e.data.message),this.messages.push({sender:"system",content:"Files uploaded successfully"})}catch(s){console.error("Error uploading files:",s),this.messages.push({sender:"system",content:"File upload failed"})}},toggleSidebar(){this.showSidebar=!this.showSidebar},async deleteConversation(e){try{await Q.A.post("/delete_conversation",{history_num:e}),this.conversations.splice(e,1),e===this.currentConversationIndex?this.conversations.length>0?this.switchConversation(0):(this.messages=[],this.currentConversationIndex=-1):e<this.currentConversationIndex&&this.currentConversationIndex--}catch(t){console.error("Error deleting conversation:",t)}}}};const re=(0,g.A)(ne,[["render",K],["__scopeId","data-v-56bc4a7e"]]);var ae=re,ie={name:"App",components:{Login:f,Register:C,ChatInterface:ae},data(){return{currentView:"login"}},methods:{onLoginSuccess(){this.currentView="chat"},showRegister(){this.currentView="register"},showLogin(){this.currentView="login"},logout(){this.currentView="login"}}};const ce=(0,g.A)(ie,[["render",a]]);var le=ce,ue=s(5798);const de=[{path:"/login",component:f},{path:"/register",component:C},{path:"/chat",component:ae}],he=(0,ue.aE)({history:(0,ue.LA)(),routes:de});var ge=he;(0,o.Ef)(le).use(ge).mount("#app")}},t={};function s(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,s),r.exports}s.m=e,function(){var e=[];s.O=function(t,o,n,r){if(!o){var a=1/0;for(u=0;u<e.length;u++){o=e[u][0],n=e[u][1],r=e[u][2];for(var i=!0,c=0;c<o.length;c++)(!1&r||a>=r)&&Object.keys(s.O).every((function(e){return s.O[e](o[c])}))?o.splice(c--,1):(i=!1,r<a&&(a=r));if(i){e.splice(u--,1);var l=n();void 0!==l&&(t=l)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[o,n,r]}}(),function(){s.d=function(e,t){for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,r,a=o[0],i=o[1],c=o[2],l=0;if(a.some((function(t){return 0!==e[t]}))){for(n in i)s.o(i,n)&&(s.m[n]=i[n]);if(c)var u=c(s)}for(t&&t(o);l<a.length;l++)r=a[l],s.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return s.O(u)},o=self["webpackChunkai_chat_app"]=self["webpackChunkai_chat_app"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=s.O(void 0,[504],(function(){return s(127)}));o=s.O(o)})();
//# sourceMappingURL=app.697e86a2.js.map